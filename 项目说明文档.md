# 时间序列预测库 (Time Series Library) 项目说明文档

## 项目概述

这是一个综合性的时间序列分析库，主要专注于**时间序列预测**任务，支持五种主要任务类型：**长期预测、短期预测、缺失值填补、异常检测和分类**。该项目集成了30多种最先进的时间序列预测模型，提供了统一的实验框架和丰富的数据处理能力。

## 主要特性

- **丰富的模型库**：包含30+种时间序列预测模型
- **多任务支持**：长期预测、短期预测、缺失值填补、异常检测、分类
- **统一的实验框架**：一致的训练、测试、验证接口
- **全面的数据支持**：支持多种时间序列数据格式
- **ARIMA+GARCH扩展**：增强的传统统计方法支持

## 项目结构详解

### 核心目录和文件

#### 1. **主要执行文件**

**`run.py`** - 主程序入口
- 统一的命令行接口，支持所有时间序列任务
- 参数配置管理（模型选择、数据设置、训练参数等）
- 自动选择对应的实验类（长期预测、短期预测等）
- GPU/CPU设备管理和多GPU支持

**主要参数类型：**
- 基础配置：任务类型、模型选择、数据路径
- 数据参数：序列长度、预测长度、特征类型（单变量/多变量）
- 模型参数：网络维度、注意力头数、层数等
- 训练参数：学习率、批大小、训练轮数、早停机制

#### 2. **模型库 (`models/`)**

包含30+种时间序列预测模型，覆盖多种架构类型：

**Transformer系列模型 (12种)**
- `Autoformer.py` - 自相关机制的Transformer，O(L log L)复杂度
- `Informer.py` - 稀疏注意力Transformer，适合长序列预测
- `FEDformer.py` - 频域增强分解Transformer，支持傅里叶和小波变换
- `iTransformer.py` - 倒置Transformer，专为多变量时间序列设计
- `PatchTST.py` - 基于patch的Transformer
- `TimesNet.py` - 2D卷积Transformer，将1D时间序列转换为2D处理
- `Crossformer.py` - 跨维度Transformer
- `ETSformer.py` - 指数平滑启发的Transformer
- `Nonstationary_Transformer.py` - 处理非平稳时间序列
- `Pyraformer.py` - 金字塔注意力机制
- `Reformer.py` - 内存高效的Transformer
- `Transformer.py` - 经典Transformer架构

**线性/MLP模型 (3种)**
- `DLinear.py` - 分解+线性层的简单有效方法
- `TiDE.py` - 时间序列密集编码器，基于MLP
- `TSMixer.py` - MLP-Mixer时间序列版本

**CNN模型 (2种)**
- `SCINet.py` - 样本卷积交互网络
- `TimesNet.py` - 2D变分建模的通用时间序列分析

**RNN模型 (1种)**
- `SegRNN.py` - 段式循环神经网络

**状态空间模型 (3种)**
- `Mamba.py` - 线性时间序列建模，选择性状态空间
- `MambaSimple.py` - 简化版Mamba实现
- `FiLM.py` - 频率改进的Legendre内存模型

**专用架构 (9种)**
- `Koopa.py` - 基于傅里叶的非平稳建模
- `FreTS.py` - 频域MLP
- `LightTS.py` - 轻量级采样导向MLP
- `MICN.py` - 多尺度等距卷积网络
- `TimeMixer.py` - 可分解多尺度混合
- `WPMixer.py` - 小波包高效多分辨率混合
- `MultiPatchFormer.py` - 多patch尺寸Transformer
- `PAttn.py` - patch注意力模型
- `TemporalFusionTransformer.py` - 多水平时间融合Transformer
- `TimeXer.py` - 外生变量时间序列预测

#### 3. **实验框架 (`exp/`)**

统一的实验管理系统，支持不同的时间序列任务：

**`exp_basic.py`** - 基础实验类
- 包含所有30+模型的注册字典
- 提供统一的模型构建接口
- 设备管理（CUDA/CPU）

**`exp_long_term_forecasting.py`** - 长期预测实验
- 标准的时间序列预测任务
- 支持DTW动态时间规整指标
- 数据增强功能

**`exp_short_term_forecasting.py`** - 短期预测实验
- 专门针对M4竞赛风格任务
- 特殊损失函数：MAPE、MASE、SMAPE
- M4数据集专用评估

**`exp_classification.py`** - 时间序列分类
- 动态序列长度适应
- 自动确定类别数量
- 准确率计算

**`exp_anomaly_detection.py`** - 异常检测
- 精确率/召回率/F分数评估
- 阈值调整工具

**`exp_imputation.py`** - 缺失值填补
- 使用预测指标评估填补质量
- 可视化分析工具

#### 4. **数据处理 (`data_provider/`)**

全面的数据加载和处理系统：

**`data_factory.py`** - 数据工厂类
- 统一的数据加载接口
- 根据数据集名称自动选择合适的加载器

**`data_loader.py`** - 主要数据加载器
- 通用CSV时间序列数据加载
- 支持单变量(S)、多变量(M)、多变量预测单变量(MS)
- 70/15/15训练/验证/测试划分

**`exchange_rate.py`** - 汇率数据加载器
- 专门处理汇率时间序列
- 期望格式：日期和汇率列

**`gbp_cny.py`** - 英镑人民币汇率专用加载器
- 针对特定货币对的数据处理
- 30天预测水平默认设置

**`m4.py`** - M4竞赛数据加载器
- 支持多种频率：年、季、月、周、日、时
- 变长时间序列处理
- 内置训练/测试划分

**`uea.py`** - UEA时间序列分类数据
- 支持.ts文件格式
- 变长多变量时间序列

#### 5. **网络层组件 (`layers/`)**

提供各种神经网络层的实现：

- `AutoCorrelation.py` - 自相关机制
- `Transformer_EncDec.py` - Transformer编码器解码器
- `SelfAttention_Family.py` - 自注意力机制家族
- `Embed.py` - 嵌入层（时间特征、位置编码）
- `Conv_Blocks.py` - 卷积块
- `StandardNorm.py` - 标准化层
- `FourierCorrelation.py` - 傅里叶相关性
- `MultiWaveletCorrelation.py` - 多小波相关性

#### 6. **工具函数 (`utils/`)**

辅助工具和评估指标：

- `metrics.py` - 评估指标（MSE、MAE、MAPE等）
- `timefeatures.py` - 时间特征提取
- `tools.py` - 通用工具函数
- `losses.py` - 损失函数
- `augmentation.py` - 数据增强
- `dtw_metric.py` - DTW距离计算

#### 7. **ARIMA+GARCH扩展模块**

传统统计方法的现代化实现：

**`arima_garch_baseline.py`** - ARIMA+GARCH基准模型
- 传统统计方法与深度学习的结合
- 多种GARCH变体支持（ARCH、GARCH、EGARCH、GARCH-M）

**`optimized_arima_garch_multistep.py`** - 优化版多步预测
- 支持1-180天多步预测
- 70/15/15数据划分一致性
- 增强的异常处理和稳健性

**主要特性：**
- 全面的模型覆盖：支持所有ARMA+GARCH组合
- Constant均值支持：新增对常数均值的支持
- 多步预测优化：正确处理误差累积效应
- 长期预测能力：支持长达180天的预测
- 结果CSV格式保存：便于后续分析

#### 8. **数据集 (`dataset/`)**

包含多种时间序列数据：

- `m4/` - M4竞赛完整数据集
- `美元兑日元_20250516_084536.csv` - 美元日元汇率数据
- `英镑兑人民币_20250324_102930.csv` - 英镑人民币汇率数据
- `sorted_output_file.csv` - 排序后的时间序列数据
- `USDCPY.csv` - 美元人民币汇率数据

#### 9. **结果和检查点 (`results/`, `checkpoints/`)**

**结果目录：**
- `results/` - 实验结果汇总
- `arima_garch_results_*` - ARIMA+GARCH模型结果目录
- `ffnn_results_*` - 前馈神经网络结果

**检查点目录：**
- `checkpoints/` - 训练好的模型权重
- 按模型、数据集、参数配置组织的层次结构

#### 10. **脚本和配置文件**

**`scripts/`** - 实验脚本集合
- 长期预测脚本
- 短期预测脚本
- 分类和异常检测脚本
- 按任务和数据集组织

**其他重要文件：**
- `requirements.txt` - Python依赖包列表
- `README.md` - 项目说明和使用指南
- `tutorial/` - TimesNet教程和示例
- `compare_results.py` - 结果比较工具
- `convert_metrics_to_csv.py` - 指标转换工具

## 使用方法

### 基本使用

```bash
# 长期预测
python run.py --task_name long_term_forecast --is_training 1 --root_path ./dataset/ --data_path ETTh1.csv --model_id ETTh1_96_96 --model TimesNet --data ETTh1 --features M --seq_len 96 --pred_len 96 --e_layers 2 --d_layers 2 --factor 3 --enc_in 7 --dec_in 7 --c_out 7 --des 'Exp' --itr 1

# 短期预测
python run.py --task_name short_term_forecast --is_training 1 --root_path ./dataset/ --data_path m4/ --model_id m4_48_48 --model TimesNet --data m4 --features M --seq_len 48 --pred_len 48 --e_layers 2 --d_layers 2

# ARIMA+GARCH预测
python optimized_arima_garch_multistep.py --root_path ./dataset/ --data_path sorted_output_file.csv --target rate --seq_len 96
```

### 主要参数说明

- `--task_name`: 任务类型 [long_term_forecast, short_term_forecast, imputation, classification, anomaly_detection]
- `--model`: 模型名称 [TimesNet, Autoformer, Informer, 等30+种模型]
- `--data`: 数据集类型 [ETTh1, ETTm1, exchange_rate, m4, custom等]
- `--seq_len`: 输入序列长度
- `--pred_len`: 预测序列长度
- `--features`: 预测模式 [M:多变量预测多变量, S:单变量预测单变量, MS:多变量预测单变量]

## 项目特点

1. **模型丰富性**：集成了30+种时间序列预测模型，从经典的Transformer到最新的Mamba状态空间模型
2. **任务全面性**：支持时间序列分析的五大主要任务
3. **数据兼容性**：支持多种数据格式和时间序列类型
4. **实验一致性**：统一的实验框架确保公平比较
5. **扩展性强**：易于添加新模型和新任务类型
6. **传统方法集成**：ARIMA+GARCH等统计方法的现代化实现

## 应用场景

- **金融预测**：股票价格、汇率、商品价格预测
- **能源预测**：电力负荷、可再生能源发电预测
- **交通预测**：交通流量、需求预测
- **气象预测**：温度、降水等气象要素预测
- **工业预测**：设备状态、生产指标预测

这个项目为时间序列分析研究提供了一个全面、统一、易用的平台，适合研究人员和工程师进行时间序列预测相关的工作。